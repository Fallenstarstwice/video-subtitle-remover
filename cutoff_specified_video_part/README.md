# 视频片段删除工具

从 Excel 文件读取视频路径和时间戳，使用 FFmpeg 删除视频中的指定片段。

## 功能特点

- 从 Excel 读取视频路径（第一列）和时间戳（后续列）
- 自动解析时间戳格式 `{"timestamp_start": "001:13", "timestamp_end": "001:18"}`
- 智能路径解析（支持绝对路径、相对路径）
- 删除多个时间片段并自动拼接
- 详细的错误提示和处理日志

## 安装依赖

```bash
# 使用 uv（推荐）
uv sync

# 或使用 pip
pip install -e .
```

## 系统要求

- Python 3.11+
- FFmpeg（必须安装并添加到系统 PATH）

### 安装 FFmpeg
请按照FFmpeg官网安装.

## 使用方法

### 1. 准备 Excel 文件

Excel 文件格式：

| 视频路径 | 时间戳1 | 时间戳2 | ... |
|---------|---------|---------|-----|
| `C:\videos\sample1.mp4` | `{"timestamp_start": "001:13", "timestamp_end": "001:18"}` | `{"timestamp_start": "015:28", "timestamp_end": "016:51"}` | ... |
| `sample2.mp4` | `{"timestamp_start": "002:00", "timestamp_end": "003:00"}` | | ... |

**说明：**
- 第一列：视频文件路径（支持绝对路径和相对路径）
- 后续列：要删除的时间段（JSON 格式）
- 时间戳格式：`MMM:SS`（如 `001:13` = 1分13秒）

### 2. 运行工具

```bash
# 基本用法
python main.py 视频剪辑-待切除视频时间戳清单.xlsx

# 指定输出目录
python main.py 视频剪辑-待切除视频时间戳清单.xlsx -o "D:\output"
```

### 3. 输出结果

处理后的视频将保存为：
- 与原视频同目录：`原文件名_edited.ext`
- 如果指定输出目录：保存到指定目录

示例：
```
原视频: sample.mp4
输出视频: sample_edited.mp4
```

## 处理流程

```
原视频: [=================00:00~00:10=================]
删除:              [01:13~01:18]      [15:28~16:51]
结果:   [====00:00~01:13====][====01:18~15:28====][====16:51~结尾====]
```

## 错误处理

工具会自动跳过错误的行并继续处理：

- ✅ 视频文件不存在 → 提示并跳过
- ✅ 时间戳格式错误 → 提示并跳过该列
- ✅ FFmpeg 执行失败 → 记录错误并继续

## 示例输出

```
============================================================
视频片段删除工具
============================================================
Excel文件: 视频剪辑-待切除视频时间戳清单.xlsx
输出目录: None
============================================================

正在读取Excel文件...
✓ 成功读取 3 行数据

[行2] 正在处理: sample1.mp4
  要删除的片段: 2 个
    - 00:01:13.000 ~ 00:01:18.000
    - 00:15:28.000 ~ 00:16:51.000
  ✓ 成功! 输出: C:\videos\sample1_edited.mp4

[行3] 正在处理: sample2.mp4
  要删除的片段: 1 个
    - 00:02:00.000 ~ 00:03:00.000
  ✓ 成功! 输出: C:\videos\sample2_edited.mp4

============================================================
处理完成!
============================================================
成功: 2 个
失败: 1 个

失败列表:
  [行4] missing.mp4
    原因: 找不到视频文件: missing.mp4
============================================================
```

## 项目结构

```
cutoff_specified_video_part/
├── main.py                  # 主程序入口
├── excel_handler.py         # Excel 读取和解析
├── video_processor.py       # FFmpeg 视频处理
├── path_resolver.py         # 路径解析工具
├── pyproject.toml           # 项目配置
└── README.md                # 本文档
```

## 技术细节

### 时间戳解析
- 输入格式：`"001:13"` → 1分13秒
- 自动转换为：`"00:01:13.000"`

### 视频处理
- 使用 FFmpeg concat filter 拼接片段
- 支持多个删除片段自动合并重叠部分
- 重新编码以保证拼接质量

### 路径解析优先级
1. 绝对路径
2. 相对于 Excel 文件的路径
3. 相对于当前工作目录的路径

## 许可证

MIT License
